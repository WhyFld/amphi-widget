<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AMPHI Widget</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      margin: 0;
      padding: 0;
      background: transparent;
    }

    .glass-popup {
  background: rgba(0, 0, 0, 0.40);
      backdrop-filter: blur(40px) saturate(180%);
      -webkit-backdrop-filter: blur(40px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, 0.18);
      box-shadow: 
        0 8px 32px 0 rgba(0, 0, 0, 0.15),
        inset 0 1px 0 0 rgba(255, 255, 255, 0.2);
    }

    .glass-popup h2,
    .glass-popup p {
      text-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
    }

    .campaign-area {
      background: rgba(255, 255, 255, 0.1);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.2);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95);
      }
      to {
        opacity: 1;
        transform: translateY(0) scale(1);
      }
    }

    .popup-enter {
      animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1);
    }

    /* Carousel slide animations */
    @keyframes slideInFromRight {
      from {
        opacity: 0;
        transform: translateX(30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    @keyframes slideInFromLeft {
      from {
        opacity: 0;
        transform: translateX(-30px);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }

    .slide-right {
      animation: slideInFromRight 0.3s ease-out;
    }

    .slide-left {
      animation: slideInFromLeft 0.3s ease-out;
    }

    .carousel-dot {
      transition: all 0.3s ease;
      backdrop-filter: blur(10px);
    }
    
    .carousel-dot.active {
      background: #CCFF66;
      width: 24px;
      border-radius: 4px;
      box-shadow: 0 2px 12px rgba(204, 255, 102, 0.5);
    }

    /* Arrows - firmly positioned outside content area */
    .arrow-btn {
      position: absolute;
      top: 50%;
      transform: translateY(-50%);
      background: rgba(255, 255, 255, 0.15);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.25);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      z-index: 30;
    }

    .arrow-btn:hover {
      background: rgba(255, 255, 255, 0.25);
      transform: translateY(-50%) scale(1.05);
    }

    .arrow-btn.left {
      left: 5px;
    }

    .arrow-btn.right {
      right: 5px;
    }

    /* Poll option buttons */
    .poll-option {
      background: rgba(255, 255, 255, 0.1);
      border: 2px solid rgba(255, 255, 255, 0.2);
      transition: all 0.2s;
    }
    .poll-option:hover {
      background: rgba(255, 255, 255, 0.15);
      border-color: rgba(204, 255, 102, 0.5);
    }
    .poll-option.selected {
      background: rgba(204, 255, 102, 0.2);
      border-color: #CCFF66;
    }

    /* Text input styling */
    textarea, input[type="text"], input[type="email"] {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      outline: none;
    }
    textarea:focus, input:focus {
      border-color: #CCFF66;
      background: rgba(255, 255, 255, 0.15);
    }
    textarea::placeholder, input::placeholder {
      color: rgba(255, 255, 255, 0.4);
    }

    /* Recording states */
    .recording {
      animation: pulse 1.5s infinite;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.6; }
    }
  </style>
</head>
<body>

<div id="widget-root" class="w-full h-screen flex items-center justify-center p-4">
  <div class="glass-popup popup-enter rounded-3xl w-full max-w-lg relative overflow-hidden" style="min-height: 520px;">
    
    <!-- CLOSE BUTTON -->
    <button onclick="closeWidget()" class="absolute top-4 right-4 text-white/60 hover:text-white text-2xl font-bold z-10 transition-colors">
      √ó
    </button>

    <!-- BACK BUTTON (shown in step 2) -->
    <button id="backBtn" onclick="goBack()" class="absolute top-4 left-4 text-white/60 hover:text-white text-xl font-bold z-10 transition-colors hidden">
      ‚Üê Back
    </button>

    <!-- ARROW BUTTONS (shown in step 1 only) -->
    <button id="leftArrow" onclick="prevCampaign()" class="arrow-btn left hidden">
      <span class="text-xl">‚Üê</span>
    </button>
    <button id="rightArrow" onclick="nextCampaign()" class="arrow-btn right hidden">
      <span class="text-xl">‚Üí</span>
    </button>

    <!-- CONTENT AREA -->
    <div id="content" class="p-8 pt-12">
      <!-- Content will be dynamically injected here -->
    </div>

    <!-- AMPHI BRANDING -->
    <div class="text-center pb-4 text-white/30 text-xs">
      Powered by AMPHI
    </div>

  </div>
</div>

<script>
// ============================================
// STATE MANAGEMENT
// ============================================
let currentStep = 1;
let currentCampaignIndex = 0;
let currentQuestionIndex = 0;
let formData = {};

// DEMO CAMPAIGNS
const campaigns = [
  {
    id: 1,
    type: 'poll',
    icon: 'üìä',
    title: 'Rate our service',
    description: 'Quick 2-minute poll',
    reward: 5,
    questions: [
      {
        question: 'How satisfied are you with our product?',
        options: ['Very Satisfied', 'Satisfied', 'Neutral', 'Unsatisfied', 'Very Unsatisfied']
      },
      {
        question: 'Would you recommend us to a friend?',
        options: ['Definitely', 'Probably', 'Not Sure', 'Probably Not', 'Definitely Not']
      }
    ]
  },
  {
    id: 2,
    type: 'text_feedback',
    icon: 'üí¨',
    title: 'Share your thoughts',
    description: '3 quick questions',
    reward: 8,
    questions: [
      'What do you love most about our product?',
      'What could we improve?',
      'Any other feedback for us?'
    ]
  },
  {
    id: 3,
    type: 'video_upload',
    icon: 'üé•',
    title: 'Record a video review',
    description: 'Max 90 seconds',
    reward: 15,
    instructions: 'Tell us about your experience with our product!'
  },
  {
    id: 4,
    type: 'audio_upload',
    icon: 'üé§',
    title: 'Voice feedback',
    description: 'Max 60 seconds',
    reward: 10,
    instructions: 'Share your thoughts in a quick voice message'
  },
  {
    id: 5,
    type: 'image_upload',
    icon: 'üì∏',
    title: 'Share a photo',
    description: 'One quick photo',
    reward: 5,
    instructions: 'Take a photo of you using our product'
  }
];

// ============================================
// NAVIGATION
// ============================================
function goBack() {
  if (currentStep === 2) {
    currentStep = 1;
    currentQuestionIndex = 0;
    formData = {};
    renderStep1();
  }
}

function closeWidget() {
  window.parent.postMessage({ action: 'minimize' }, '*');
}

function nextCampaign() {
  currentCampaignIndex = (currentCampaignIndex + 1) % campaigns.length;
  const content = document.getElementById('content');
  content.classList.remove('slide-left', 'slide-right');
  void content.offsetWidth;
  content.classList.add('slide-right');
  renderStep1();
}

function prevCampaign() {
  currentCampaignIndex = (currentCampaignIndex - 1 + campaigns.length) % campaigns.length;
  const content = document.getElementById('content');
  content.classList.remove('slide-left', 'slide-right');
  void content.offsetWidth;
  content.classList.add('slide-left');
  renderStep1();
}

function startCampaign() {
  currentStep = 2;
  currentQuestionIndex = 0;
  formData = {};
  renderStep2();
}

// ============================================
// STEP 1: CAMPAIGN CAROUSEL
// ============================================
function renderStep1() {
  document.getElementById('backBtn').classList.add('hidden');
  
  // Show/hide arrows
  if (campaigns.length > 1) {
    document.getElementById('leftArrow').classList.remove('hidden');
    document.getElementById('rightArrow').classList.remove('hidden');
  } else {
    document.getElementById('leftArrow').classList.add('hidden');
    document.getElementById('rightArrow').classList.add('hidden');
  }
  
  const campaign = campaigns[currentCampaignIndex];
  
  let taskDetails = '';
  if (campaign.type === 'poll') {
    taskDetails = `${campaign.questions.length} quick questions`;
  } else if (campaign.type === 'text_feedback') {
    taskDetails = `${campaign.questions.length} text questions`;
  } else if (campaign.type === 'video_upload') {
    taskDetails = 'Record 90-second video';
  } else if (campaign.type === 'audio_upload') {
    taskDetails = 'Record 60-second audio';
  } else if (campaign.type === 'image_upload') {
    taskDetails = 'Upload 1 photo';
  }

  document.getElementById('content').innerHTML = `
    <h2 class="text-white text-2xl font-bold text-center mb-8">
      ${campaign.title} & earn ¬£${campaign.reward}
    </h2>

    <div class="campaign-area rounded-2xl p-8 mb-6 min-h-[280px] flex items-center justify-center">
      <div class="text-center">
        <div class="text-6xl mb-4">${campaign.icon}</div>
        <p class="text-white/80 text-lg font-semibold mb-2">${campaign.title}</p>
        <p class="text-white/50 text-sm mb-1">${campaign.description}</p>
        <p class="text-white/40 text-xs mt-2">${taskDetails}</p>
      </div>
    </div>

    <div class="flex justify-center gap-2 mb-6">
      ${campaigns.map((c, i) => `
        <div class="carousel-dot ${i === currentCampaignIndex ? 'active' : 'h-2 w-2 rounded-full bg-white/30'}"></div>
      `).join('')}
    </div>

    <button onclick="startCampaign()" class="w-full py-4 bg-[#CCFF66] hover:bg-[#b8e659] text-black font-bold rounded-xl transition-all text-lg">
      Start & Earn ¬£${campaign.reward} ‚Üí
    </button>
  `;
}

// ============================================
// STEP 2: CAMPAIGN FORM
// ============================================
function renderStep2() {
  document.getElementById('backBtn').classList.remove('hidden');
  document.getElementById('leftArrow').classList.add('hidden');
  document.getElementById('rightArrow').classList.add('hidden');
  
  const campaign = campaigns[currentCampaignIndex];

  if (campaign.type === 'poll') {
    renderPoll(campaign);
  } else if (campaign.type === 'text_feedback') {
    renderTextFeedback(campaign);
  } else if (campaign.type === 'video_upload') {
    renderVideoUpload(campaign);
  } else if (campaign.type === 'audio_upload') {
    renderAudioUpload(campaign);
  } else if (campaign.type === 'image_upload') {
    renderImageUpload(campaign);
  }
}

// POLL
function renderPoll(campaign) {
  const question = campaign.questions[currentQuestionIndex];
  const totalQuestions = campaign.questions.length;
  const isLastQuestion = currentQuestionIndex === totalQuestions - 1;

  document.getElementById('content').innerHTML = `
    <div class="text-center mb-4">
      <div class="text-white/50 text-sm mb-2">Question ${currentQuestionIndex + 1} of ${totalQuestions}</div>
      <h3 class="text-white text-xl font-bold">${question.question}</h3>
    </div>

    <div class="space-y-3 mb-6">
      ${question.options.map((option, i) => `
        <button onclick="selectPollOption(${i})" 
                id="poll-option-${i}"
                class="poll-option w-full py-4 px-6 rounded-xl text-white font-medium text-left">
          ${option}
        </button>
      `).join('')}
    </div>

    <button id="nextBtn" onclick="${isLastQuestion ? 'submitPoll()' : 'nextPollQuestion()'}" 
            class="w-full py-4 bg-[#CCFF66] hover:bg-[#b8e659] text-black font-bold rounded-xl transition-all text-lg opacity-50 cursor-not-allowed" 
            disabled>
      ${isLastQuestion ? 'Submit & Get Paid ‚Üí' : 'Next Question ‚Üí'}
    </button>
  `;
}

function selectPollOption(index) {
  document.querySelectorAll('.poll-option').forEach(btn => {
    btn.classList.remove('selected');
  });
  
  document.getElementById(`poll-option-${index}`).classList.add('selected');
  
  const campaign = campaigns[currentCampaignIndex];
  const question = campaign.questions[currentQuestionIndex];
  formData[`question_${currentQuestionIndex}`] = question.options[index];
  
  const nextBtn = document.getElementById('nextBtn');
  nextBtn.disabled = false;
  nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
}

function nextPollQuestion() {
  currentQuestionIndex++;
  renderStep2();
}

function submitPoll() {
  console.log('Poll submitted:', formData);
  renderStep3();
}

// TEXT FEEDBACK
function renderTextFeedback(campaign) {
  const question = campaign.questions[currentQuestionIndex];
  const totalQuestions = campaign.questions.length;
  const isLastQuestion = currentQuestionIndex === totalQuestions - 1;

  document.getElementById('content').innerHTML = `
    <div class="text-center mb-4">
      <div class="text-white/50 text-sm mb-2">Question ${currentQuestionIndex + 1} of ${totalQuestions}</div>
      <h3 class="text-white text-xl font-bold mb-6">${question}</h3>
    </div>

    <textarea id="textInput" 
              onkeyup="checkTextInput()"
              placeholder="Type your answer here..." 
              rows="6" 
              maxlength="500"
              class="w-full p-4 rounded-xl mb-2 resize-none"></textarea>
    
    <div class="text-white/40 text-xs text-right mb-6">
      <span id="charCount">0</span>/500 characters
    </div>

    <button id="nextBtn" onclick="${isLastQuestion ? 'submitText()' : 'nextTextQuestion()'}" 
            class="w-full py-4 bg-[#CCFF66] hover:bg-[#b8e659] text-black font-bold rounded-xl transition-all text-lg opacity-50 cursor-not-allowed" 
            disabled>
      ${isLastQuestion ? 'Submit & Get Paid ‚Üí' : 'Next Question ‚Üí'}
    </button>
  `;
}

function checkTextInput() {
  const input = document.getElementById('textInput');
  const count = input.value.length;
  document.getElementById('charCount').textContent = count;
  
  const nextBtn = document.getElementById('nextBtn');
  if (count > 10) {
    formData[`question_${currentQuestionIndex}`] = input.value;
    nextBtn.disabled = false;
    nextBtn.classList.remove('opacity-50', 'cursor-not-allowed');
  } else {
    nextBtn.disabled = true;
    nextBtn.classList.add('opacity-50', 'cursor-not-allowed');
  }
}

function nextTextQuestion() {
  currentQuestionIndex++;
  renderStep2();
}

function submitText() {
  console.log('Text submitted:', formData);
  renderStep3();
}

// VIDEO UPLOAD
function renderVideoUpload(campaign) {
  document.getElementById('content').innerHTML = `
    <div class="text-center mb-6">
      <h3 class="text-white text-xl font-bold mb-2">${campaign.title}</h3>
      <p class="text-white/60 text-sm">${campaign.instructions}</p>
    </div>

    <div class="campaign-area rounded-2xl p-8 mb-6 min-h-[280px] flex items-center justify-center">
      <div class="text-center">
        <div class="text-6xl mb-4">üé•</div>
        <p class="text-white/80 text-lg font-semibold mb-2">Ready to record?</p>
        <p class="text-white/50 text-sm">Max 90 seconds</p>
      </div>
    </div>

    <button onclick="alert('Video recording would start here! (Coming in next iteration)')" 
            class="w-full py-4 bg-[#CCFF66] hover:bg-[#b8e659] text-black font-bold rounded-xl transition-all text-lg">
      üé• Start Recording
    </button>
  `;
}

// AUDIO UPLOAD
function renderAudioUpload(campaign) {
  document.getElementById('content').innerHTML = `
    <div class="text-center mb-6">
      <h3 class="text-white text-xl font-bold mb-2">${campaign.title}</h3>
      <p class="text-white/60 text-sm">${campaign.instructions}</p>
    </div>

    <div class="campaign-area rounded-2xl p-8 mb-6 min-h-[280px] flex items-center justify-center">
      <div class="text-center">
        <div class="text-6xl mb-4">üé§</div>
        <p class="text-white/80 text-lg font-semibold mb-2">Ready to record?</p>
        <p class="text-white/50 text-sm">Max 60 seconds</p>
      </div>
    </div>

    <button onclick="alert('Audio recording would start here! (Coming in next iteration)')" 
            class="w-full py-4 bg-[#CCFF66] hover:bg-[#b8e659] text-black font-bold rounded-xl transition-all text-lg">
      üé§ Start Recording
    </button>
  `;
}

// IMAGE UPLOAD
function renderImageUpload(campaign) {
  document.getElementById('content').innerHTML = `
    <div class="text-center mb-6">
      <h3 class="text-white text-xl font-bold mb-2">${campaign.title}</h3>
      <p class="text-white/60 text-sm">${campaign.instructions}</p>
    </div>

    <div class="campaign-area rounded-2xl p-8 mb-6 min-h-[280px] flex items-center justify-center">
      <div class="text-center">
        <div class="text-6xl mb-4">üì∏</div>
        <p class="text-white/80 text-lg font-semibold mb-2">Upload a photo</p>
        <p class="text-white/50 text-sm">JPG, PNG, or HEIC</p>
      </div>
    </div>

    <button onclick="alert('Image upload would start here! (Coming in next iteration)')" 
            class="w-full py-4 bg-[#CCFF66] hover:bg-[#b8e659] text-black font-bold rounded-xl transition-all text-lg">
      üì∏ Take Photo / Upload
    </button>
  `;
}

// ============================================
// STEP 3: EMAIL + STRIPE (Placeholder)
// ============================================
function renderStep3() {
  document.getElementById('backBtn').classList.add('hidden');
  document.getElementById('leftArrow').classList.add('hidden');
  document.getElementById('rightArrow').classList.add('hidden');
  const campaign = campaigns[currentCampaignIndex];

  document.getElementById('content').innerHTML = `
    <div class="text-center mb-6">
      <div class="text-6xl mb-4">üéâ</div>
      <h3 class="text-white text-2xl font-bold mb-2">Great job!</h3>
      <p class="text-white/70 text-sm mb-6">You've completed the task</p>
    </div>

    <div class="campaign-area rounded-2xl p-6 mb-6">
      <p class="text-white/80 text-center mb-4">Enter your email to receive payment:</p>
      <input type="email" 
             id="emailInput"
             placeholder="your@email.com" 
             class="w-full p-3 rounded-xl mb-4">
    </div>

    <button onclick="alert('Next: Stripe Connect integration! (Coming soon)')" 
            class="w-full py-4 bg-[#CCFF66] hover:bg-[#b8e659] text-black font-bold rounded-xl transition-all text-lg">
      Continue to Bank Link ‚Üí
    </button>

    <p class="text-white/40 text-xs text-center mt-4">
      You'll receive ¬£${campaign.reward} within 24-48 hours after approval
    </p>
  `;
}

// ============================================
// INIT
// ============================================
renderStep1();
</script>

</body>
</html>
